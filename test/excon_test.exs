defmodule ExconTest do
  use ExUnit.Case
  doctest Excon

  @s "testdata"

  test "png" do
    std =
      <<137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 32, 0, 0, 0, 32, 8,
        3, 0, 0, 0, 68, 164, 138, 198, 0, 0, 0, 12, 80, 76, 84, 69, 0, 152, 102, 64, 178, 140,
        127, 203, 178, 191, 229, 217, 78, 253, 53, 208, 0, 0, 0, 2, 73, 68, 65, 84, 120, 156, 98,
        164, 145, 43, 0, 0, 0, 63, 73, 68, 65, 84, 99, 96, 4, 2, 102, 40, 96, 128, 2, 24, 31, 36,
        199, 64, 7, 5, 48, 9, 70, 52, 0, 83, 72, 15, 5, 48, 14, 19, 16, 192, 36, 65, 108, 152, 38,
        122, 40, 128, 49, 96, 1, 131, 204, 134, 5, 220, 72, 80, 48, 24, 226, 98, 176, 164, 201, 1,
        206, 155, 0, 216, 182, 5, 65, 220, 23, 212, 189, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96,
        130>>

    assert Excon.ident(@s) == std

    tiny =
      <<137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 8, 0, 0, 0, 8, 8,
        3, 0, 0, 0, 243, 209, 78, 185, 0, 0, 0, 12, 80, 76, 84, 69, 0, 152, 102, 64, 178, 140,
        127, 203, 178, 191, 229, 217, 78, 253, 53, 208, 0, 0, 0, 2, 73, 68, 65, 84, 120, 156, 98,
        164, 145, 43, 0, 0, 0, 39, 73, 68, 65, 84, 69, 139, 129, 9, 0, 48, 12, 194, 146, 250, 255,
        207, 115, 48, 86, 17, 34, 168, 152, 64, 34, 193, 234, 130, 209, 41, 48, 214, 108, 248,
        213, 142, 223, 253, 0, 12, 24, 0, 85, 172, 158, 193, 20, 0, 0, 0, 0, 73, 69, 78, 68, 174,
        66, 96, 130>>

    assert Excon.ident(@s, type: :png, magnification: 1) == tiny
  end

  test "svg" do
    std =
      "<svg width=\"32\" height=\"32\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n<circle cx=\"8\" cy=\"8\" r=\"8\" fill=\"rgba(51,204,255,0.65625\"/>\n<circle cx=\"8\" cy=\"24\" r=\"8\" fill=\"rgba(255,169,20,0.5625\"/>\n<circle cx=\"24\" cy=\"24\" r=\"8\" fill=\"rgba(102,217,255,0.53125\"/>\n<circle cx=\"24\" cy=\"8\" r=\"8\" fill=\"rgba(244,210,184,0.625\"/>\n<path d=\"M0,16  C32,-8 -8,32 32,32\" fill=\"rgba(255,217,102,0.84375\"/>\n</svg>\n"

    assert Excon.ident(@s, type: :svg) == std

    big =
      "<svg width=\"64\" height=\"64\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 64 64\">\n<circle cx=\"16\" cy=\"16\" r=\"16\" fill=\"rgba(51,204,255,0.65625\"/>\n<circle cx=\"16\" cy=\"48\" r=\"16\" fill=\"rgba(255,169,20,0.5625\"/>\n<circle cx=\"48\" cy=\"48\" r=\"16\" fill=\"rgba(102,217,255,0.53125\"/>\n<circle cx=\"48\" cy=\"16\" r=\"16\" fill=\"rgba(244,210,184,0.625\"/>\n<path d=\"M0,32  C64,-16 -16,64 64,64\" fill=\"rgba(255,217,102,0.84375\"/>\n</svg>\n"

    assert Excon.ident(@s, type: :svg, magnification: 8) == big
  end
end
